import Bytes from "bytes"
import Option from "option"
import Result from "result"
import String from "string"
import Http from "suborbital/http"
import Log from "suborbital/log"

export let run: Bytes -> Result<Bytes, (Int32, String)> = input =>  {

  let mut message = ""

  Log.info("ğŸ‘‹ hello from Grain")

  Log.info("ğŸŒ Calling AssemblyScript ... ğŸ˜„")
  let callAssemblyScript = Http.get("http://localhost:8088", None)


  match (callAssemblyScript) {
    Ok(value) => {
      Log.info(Bytes.toString(value))
      message = String.concat(message, Bytes.toString(value))
    },
    Err(err) => Log.error("ğŸ˜¡ ouch")
  }

  Log.info("ğŸŒ Calling JavaScript ... ğŸ˜")
  let callJavaScript = Http.get("http://localhost:8089", None)

  match (callJavaScript) {
    Ok(value) => {
      Log.info(Bytes.toString(value))
      message = String.concat(message, Bytes.toString(value))
    },
    Err(err) => Log.error("ğŸ˜¡ ouch")
  }

  //Ok(Bytes.concat(Bytes.fromString("ğŸ˜ƒ ğŸ‘‹ Hello "), input))
  Ok(Bytes.fromString(message))
}
